#! /bin/sh

if test "${nosudo-false}" != true -a `id -u` != 0; then
  echo "we're going sudo..." >&2
  exec sudo "$0" "$@"
  exit 23 # go to hell
fi

if ! ifconfig wlan0 | grep -q 'inet addr'; then
  if ! grep -q wlan0 /etc/network/interfaces; then
    cat >> /etc/network/interfaces <<EOF
# generated by rc.local
auto wlan0
iface wlan0 inet dhcp
wpa_conf /etc/wpa_supplicant/wpa_supplicant.conf
EOF
  fi

  beep -l 50 -f 2000; /etc/init.d/network-manager restart
  beep -l 50 -f 2000; ifdown wlan0
  beep -l 50 -f 2000; ifup wlan0
  if ifconfig wlan0 | grep -q 'inet addr'; then
    beep -l 50 -f 2000 -n -l 100 -f 3000
  else
    beep -l 50 -f 2000 -n -l 100 -f 1000
  fi
else
  case "${1-}" in
    (--quiet) : ;;
    (*) beep -l 50 -f 2000 -n -l 100 -f 2000 ;;
  esac
fi
